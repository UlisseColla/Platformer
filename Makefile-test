# **************************************************************************** #
#                                                                              #
#                                                         :::      ::::::::    #
#    Makefile                                           :+:      :+:    :+:    #
#                                                     +:+ +:+         +:+      #
#    By: ucolla <ucolla@student.42.fr>              +#+  +:+       +#+         #
#                                                 +#+#+#+#+#+   +#+            #
#    Created: 2024/12/01 14:36:14 by andrea            #+#    #+#              #
#    Updated: 2025/03/02 17:14:58 by ucolla           ###   ########.fr        #
#                                                                              #
# **************************************************************************** #

NAME = webserv
SRC_PATH = ./srcs
INCLUDES = -I./headers
VERBOSE = -D VERBOSE_MODE=1

SRCS = ${SRC_PATH}/AConfig.cpp \
	${SRC_PATH}/Client.cpp \
	${SRC_PATH}/main.cpp \
	${SRC_PATH}/Parser.cpp \
	${SRC_PATH}/ParserUtils.cpp \
	${SRC_PATH}/Request.cpp \
	${SRC_PATH}/Response.cpp \
	${SRC_PATH}/Router.cpp \
	${SRC_PATH}/Server.cpp \
	${SRC_PATH}/ServerConfig.cpp \
	${SRC_PATH}/ServerManager.cpp 

CC = c++
CFLAGS = -Wall -Wextra -Werror -std=c++98 -g ${INCLUDES}

GREEN = \033[0;32m
RED = \033[0;31m
NC = \033[0m

generate_default_config:
	@if [ ! -f ./utils/configs/default_config.conf ]; then \
		echo "Generating default config file..."; \
		current_dir=$$(pwd); \
		utils="$$current_dir/utils"; \
		echo "server {" 							> ./utils/configs/default_config.conf; \
		echo "	listen 			localhost:8080;" 	>> ./utils/configs/default_config.conf; \
		echo "	root 			$$utils;" 			>> ./utils/configs/default_config.conf; \
		echo "	default_file 	index.html;" 		>> ./utils/configs/default_config.conf; \
		echo "}" 									>> ./utils/configs/default_config.conf; \
	else \
		echo "Config file already exists."; \
	fi

all: ${NAME}

${NAME}: ${SRCS} generate_default_config
	@${CC} ${CFLAGS} ${SRCS} -o ${NAME} && \
	echo '${GREEN}  / _ \' && \
	echo '\_\(_)/_/' && \
	echo ' *//"\\*' && \
	echo ' /     \ ${NC}' || \
	(echo '${RED}  / _ \' && \
	echo '\_\(_)/_/' && \
	echo ' *//"\\*' && \
	echo ' /     \ ${NC}')

verbose: ${SRCS} generate_default_config
	@${CC} ${CFLAGS} ${VERBOSE} ${SRCS} -o ${NAME} && \
	echo "-- VERBOSE MODE --" && \
	echo '${GREEN}  / _ \' && \
	echo '\_\(_)/_/' && \
	echo ' *//"\\*' && \
	echo ' /     \ ${NC}' || \
	(echo '${RED}  / _ \' && \
	echo '\_\(_)/_/' && \
	echo ' *//"\\*' && \
	echo ' /     \ ${NC}')

clean:
	@echo "Nothing to clean. No object files created."

fclean:
	@if [ -f ./utils/configs/default_config.conf ]; then \
		rm ./utils/configs/default_config.conf; \
	fi
	/bin/rm -f ${NAME}

re: fclean all

run: all
	clear && ./${NAME}

.PHONY: all clean fclean re
